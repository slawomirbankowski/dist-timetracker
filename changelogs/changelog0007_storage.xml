<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd"
        logicalFilePath="conf/changelog0007_storage.xml">

    <changeSet id="0007 - storage" author="slawomir.bankowski">

        <createTable tableName="storage_type" remarks="type of storages: JDBC, Elasticsearch, Mongodb, Cassandra, ..." >
            <column name="storage_type_uid" type="text" remarks=""><constraints primaryKey="true" nullable="false"/></column>
            <column name="storage_type_name" type="text"><constraints nullable="false"/></column>
            <!-- FKs -->
            <!-- attribute columns -->
            <column name="storage_class" type="text" defaultValue="" remarks=""><constraints nullable="false"/></column>
            <!-- metadata columns -->
            <column name="row_instance" type="text" remarks="FK to system instance" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" remarks="FK to table system_lock - logical lock of current row" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true" remarks="sequence number of this row in table"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="generate_uid('stty')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active, -1 - rows is on hold, -2 - row is locked"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>

        <createTable tableName="storage_category" remarks="categories of storages: Import, Export, , ..." >
            <column name="storage_category_uid" type="text" remarks=""><constraints primaryKey="true" nullable="false"/></column>
            <column name="storage_category_name" type="text"><constraints nullable="false"/></column>
            <!-- FKs -->
            <!-- attribute columns -->
            <!-- metadata columns -->
            <column name="row_instance" type="text" remarks="FK to system instance" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" remarks="FK to table system_lock - logical lock of current row" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true" remarks="sequence number of this row in table"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="generate_uid('stty')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active, -1 - rows is on hold, -2 - row is locked"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>

        <createTable tableName="storage" remarks="single storage with external data for application; storage can be used to import data or export data through synchronization jobs or any other internal actions" >
            <column name="storage_uid" type="text" remarks="UID of storage"><constraints primaryKey="true" nullable="false"/></column>
            <column name="storage_name" type="text" remarks="friendly name of storage"><constraints nullable="false"/></column>
            <!-- FKs -->
            <column name="tenant_uid" type="text" remarks="tenant - owner of this storage"><constraints nullable="false"/></column>
            <column name="account_uid" type="text" remarks="main account responsible of this storage"><constraints nullable="false"/></column>
            <column name="storage_type_uid" type="text" remarks="type of storage"><constraints nullable="false"/></column>
            <column name="storage_category_uid" type="text" remarks="type of storage"><constraints nullable="false"/></column>
            <!-- attribute columns -->
            <column name="storage_parameters_json" type="text" remarks="JSON with storage connection parameters"><constraints nullable="false"/></column>
            <!-- FKs -->
            <!-- metadata columns -->
            <column name="row_instance" type="text" remarks="FK to system instance" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" remarks="FK to table system_lock - logical lock of current row" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true" remarks="sequence number of this row in table"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="generate_uid('stor')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active, -1 - rows is on hold, -2 - row is locked"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>

        <createTable tableName="storage_connection" remarks="connection to external storage" >
            <column name="storage_connection_uid" type="text" remarks=""><constraints primaryKey="true" nullable="false"/></column>
            <column name="storage_connection_name" type="text"><constraints nullable="false"/></column>
            <!-- FKs -->
            <column name="storage_uid" type="text" remarks=""><constraints nullable="false"/></column>
            <!-- attribute columns -->
            <column name="connection_type" type="text" defaultValue="update" remarks=""><constraints nullable="false"/></column>
            <column name="storage_parameters_json" type="text" remarks=""><constraints nullable="false"/></column>
            <!-- metadata columns -->
            <column name="row_instance" type="text" remarks="FK to system instance" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" remarks="FK to table system_lock - logical lock of current row" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true" remarks="sequence number of this row in table"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="generate_uid('stco')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active, -1 - rows is on hold, -2 - row is locked"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>

        <createTable tableName="storage_query" remarks="query done on external storage" >
            <column name="storage_query_uid" type="text" remarks="UID of query"><constraints primaryKey="true" nullable="false"/></column>
            <column name="storage_query_name" type="text"><constraints nullable="false"/></column>
            <!-- FKs -->
            <!-- attribute columns -->
            <column name="storage_uid" type="text" remarks="UID of storage"><constraints nullable="false"/></column>
            <column name="query_content" type="text" remarks="query to be executed"><constraints nullable="false"/></column>
            <column name="query_parameters_json" type="text" remarks=""><constraints nullable="false"/></column>
            <column name="execution_status" type="text" remarks="status of execution: New, Executing, Done, Error" defaultValue="New"><constraints nullable="false"/></column>
            <column name="execution_time" type="bigint" remarks="" />
            <column name="execution_rows" type="bigint" remarks="" />
            <!-- metadata columns -->
            <column name="row_instance" type="text" remarks="FK to system instance" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" remarks="FK to table system_lock - logical lock of current row" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true" remarks="sequence number of this row in table"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="generate_uid('stqu')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active, -1 - rows is on hold, -2 - row is locked"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>

    </changeSet>

</databaseChangeLog>
