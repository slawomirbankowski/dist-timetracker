<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd"
        logicalFilePath="conf/changelog0024_invoice.xml">

    <changeSet id="0024 - invoice tables" author="slawomir.bankowski">

        <createTable tableName="invoice_flow" remarks="pre-defined flow of invoice" >
            <column name="invoice_flow_uid" type="text" defaultValueComputed="cast(uuid_generate_v4() as text)"><constraints primaryKey="true" nullable="false"/></column>
            <column name="invoice_flow_name" type="text"><constraints nullable="false"/></column>
            <!-- FKs -->
            <!-- attribute columns -->
            <column name="flow_description" type="text"><constraints nullable="false"/></column>
            <column name="flow_definition_json" type="text"><constraints nullable="false"/></column>
            <!-- metadata columns -->
            <column name="row_instance" type="text" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="replace(concat('ifl_v01_', substring(cast(now() as text), 1, 10), '_', substring(cast(uuid_generate_v4() as text), 1, 13)), '-', '_')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>

        <createTable tableName="invoice_flow_state" remarks="states of invoice flow" >
            <column name="invoice_flow_state_uid" type="text" defaultValueComputed="cast(uuid_generate_v4() as text)"><constraints primaryKey="true" nullable="false"/></column>
            <column name="invoice_flow_state_name" type="text"><constraints nullable="false"/></column>
            <!-- FKs -->
            <!-- attribute columns -->
            <column name="invoice_flow_uid" type="text"><constraints nullable="false"/></column>
            <!-- metadata columns -->
            <column name="row_instance" type="text" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="replace(concat('ifl_v01_', substring(cast(now() as text), 1, 10), '_', substring(cast(uuid_generate_v4() as text), 1, 13)), '-', '_')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>

        <createTable tableName="invoice_status" remarks="status of invoice: Created, Pending, OnHold, Approved, Rejected, Paid, Closed" >
            <column name="invoice_status_uid" type="text"><constraints primaryKey="true" nullable="false"/></column>
            <column name="invoice_status_name" type="text"><constraints nullable="false"/></column>
            <!-- FKs -->
            <!-- attribute columns -->
            <column name="status_description" type="text"><constraints nullable="false"/></column>
            <!-- Defaults -->
            <!-- metadata columns -->
            <column name="row_instance" type="text" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="replace(concat('ist_v01_', substring(cast(now() as text), 1, 10), '_', substring(cast(uuid_generate_v4() as text), 1, 13)), '-', '_')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>
        <createIndex indexName="idx_invoice_status_invoice_status_name" tableName="invoice_status" unique="true"><column name="invoice_status_name" /></createIndex>

        <createTable tableName="invoice_type" remarks="type of invoice: Default, Draft, Template" >
            <column name="invoice_type_uid" type="text"><constraints primaryKey="true" nullable="false"/></column>
            <column name="invoice_type_name" type="text"><constraints nullable="false"/></column>
            <!-- FKs -->
            <!-- attribute columns -->
            <!-- metadata columns -->
            <column name="row_instance" type="text" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="replace(concat('ist_v01_', substring(cast(now() as text), 1, 10), '_', substring(cast(uuid_generate_v4() as text), 1, 13)), '-', '_')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>

        <createTable tableName="invoice_category" remarks="client category of invoice: Internal, Correction, ..." >
            <column name="invoice_category_uid" type="text"><constraints primaryKey="true" nullable="false"/></column>
            <column name="invoice_category_name" type="text"><constraints nullable="false"/></column>
            <!-- FKs -->
            <column name="tenant_uid" type="text" remarks="type=fk;description=tenant UID"><constraints nullable="false"/></column>
            <!-- attribute columns -->
            <column name="invoice_category_description" type="text"><constraints nullable="false"/></column>
            <!-- metadata columns -->
            <column name="row_instance" type="text" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="replace(concat('ist_v01_', substring(cast(now() as text), 1, 10), '_', substring(cast(uuid_generate_v4() as text), 1, 13)), '-', '_')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>

        <createTable tableName="invoice_instance" remarks="invoices" >
            <column name="invoice_instance_uid" type="text" defaultValueComputed="cast(uuid_generate_v4() as text)"><constraints primaryKey="true" nullable="false"/></column>
            <column name="invoice_instance_name" type="text"><constraints nullable="false"/></column>
            <!-- FKs -->
            <column name="tenant_uid" type="text" remarks="type=fk;description=tenant UID"><constraints nullable="false"/></column>
            <column name="account_uid" type="text"><constraints nullable="false"/></column>
            <column name="invoice_flow_uid" type="text"><constraints nullable="false"/></column>
            <column name="invoice_status_uid" type="text" defaultValue="Created"><constraints nullable="false"/></column>
            <column name="invoice_category_uid" type="text" defaultValue="Created"><constraints nullable="false"/></column>
            <column name="invoice_type_uid" type="text" defaultValue="Created"><constraints nullable="false"/></column>
            <column name="period_uid" type="text"><constraints nullable="false"/></column>
            <column name="currency_uid" type="text" defaultValue="EUR"><constraints nullable="false"/></column>
            <!-- attribute columns -->
            <column name="invoice_number" type="text"><constraints nullable="false"/></column>
            <column name="invoice_details" type="text"><constraints nullable="false"/></column>
            <column name="invoice_amount_net" type="float" defaultValueNumeric="0"><constraints nullable="false"/></column>
            <column name="invoice_amount_tax" type="float" defaultValueNumeric="0"><constraints nullable="false"/></column>
            <column name="invoice_amount_gross" type="float" defaultValueNumeric="0"><constraints nullable="false"/></column>
            <!-- metadata columns -->
            <column name="row_instance" type="text" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="replace(concat('iin_v01_', substring(cast(now() as text), 1, 10), '_', substring(cast(uuid_generate_v4() as text), 1, 13)), '-', '_')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>
        <createIndex indexName="idx_invoice_instance_account_uid" tableName="invoice_instance" unique="false"><column name="account_uid" /></createIndex>

        <createTable tableName="invoice_entry" remarks="entry assigned to invoice" >
            <column name="invoice_entry_uid" type="text" defaultValueComputed="cast(uuid_generate_v4() as text)"><constraints primaryKey="true" nullable="false"/></column>
            <column name="invoice_entry_name" type="text"><constraints nullable="false"/></column>
            <!-- FKs -->
            <column name="tenant_uid" type="text" remarks="type=fk;description=tenant UID"><constraints nullable="false"/></column>
            <column name="account_uid" type="text"><constraints nullable="false"/></column>
            <column name="invoice_instance_uid" type="text" defaultValue="EUR"><constraints nullable="false"/></column>
            <!-- attribute columns -->
            <column name="entry_details" type="text"><constraints nullable="false"/></column>
            <column name="entry_amount_net" type="float" defaultValueNumeric="0"><constraints nullable="false"/></column>
            <column name="entry_amount_tax" type="float" defaultValueNumeric="0"><constraints nullable="false"/></column>
            <column name="entry_amount_gross" type="float" defaultValueNumeric="0"><constraints nullable="false"/></column>
            <!-- metadata columns -->
            <column name="row_instance" type="text" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="replace(concat('ien_v01_', substring(cast(now() as text), 1, 10), '_', substring(cast(uuid_generate_v4() as text), 1, 13)), '-', '_')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>
        <createIndex indexName="idx_invoice_entry_tenant_uid" tableName="invoice_entry" unique="false"><column name="tenant_uid" /></createIndex>
        <createIndex indexName="idx_invoice_entry_invoice_instance_uid" tableName="invoice_entry" unique="false"><column name="invoice_instance_uid" /></createIndex>

        <createTable tableName="invoice_action_type" remarks="types of action for invoice" >
            <column name="invoice_action_type_uid" type="text"><constraints primaryKey="true" nullable="false"/></column>
            <column name="invoice_action_type_name" type="text"><constraints nullable="false"/></column>
            <!-- FKs -->
            <!-- attribute columns -->
            <!-- metadata columns -->
            <column name="row_instance" type="text" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="replace(concat('iat_v01_', substring(cast(now() as text), 1, 10), '_', substring(cast(uuid_generate_v4() as text), 1, 13)), '-', '_')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>

        <createTable tableName="invoice_action" remarks="types of action for invoice like receive, confirm, approve, deny, correction, paying, paid, closed" >
            <column name="invoice_action_uid" type="text"><constraints primaryKey="true" nullable="false"/></column>
            <column name="invoice_action_name" type="text"><constraints nullable="false"/></column>
            <!-- FKs -->
            <column name="tenant_uid" type="text" remarks="type=fk;description=tenant UID"><constraints nullable="false"/></column>
            <column name="account_uid" type="text"><constraints nullable="false"/></column>
            <column name="invoice_instance_uid" type="text"><constraints nullable="false"/></column>
            <column name="invoice_action_type_uid" type="text"><constraints nullable="false"/></column>
            <!-- attribute columns -->
            <!-- metadata columns -->
            <column name="row_instance" type="text" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="replace(concat('iat_v01_', substring(cast(now() as text), 1, 10), '_', substring(cast(uuid_generate_v4() as text), 1, 13)), '-', '_')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>

    </changeSet>

</databaseChangeLog>
