<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd"
        logicalFilePath="conf/changelog0023_auth.xml">

    <changeSet id="0023 - auth tables for authentication and authorization" author="slawomir.bankowski">

        <createTable tableName="auth_identity" remarks="type=dictionary;cardinality=10;description=possible identity types" >
            <column name="auth_identity_uid" type="text"><constraints primaryKey="true" nullable="false"/></column>
            <column name="auth_identity_name" type="text" remarks="name of identifying method, class to authenticate user or client"><constraints nullable="false"/></column>
            <!-- FKs -->
            <!-- attribute columns -->
            <column name="class_name" type="text"><constraints primaryKey="true" nullable="false"/></column>
            <column name="default_parameters_json" type="text" remarks="" defaultValue="{}"><constraints nullable="false"/></column>
            <!-- metadata columns -->
            <column name="row_instance" type="text" remarks="FK to system instance" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="replace(concat('auid_v01_', substring(cast(now() as text), 1, 10), '_', substring(cast(uuid_generate_v4() as text), 1, 13)), '-', '_')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>

        <createTable tableName="auth_identity_tenant" remarks="type=m2m;cardinality=1000;description=possible identity types with configuration" >
            <column name="auth_identity_tenant_uid" type="text" defaultValueComputed="generate_uid('arat')"><constraints primaryKey="true" nullable="false"/></column>
            <column name="auth_identity_tenant_name" type="text" remarks="name of identifying method, class to authenticate user or client"><constraints nullable="false"/></column>
            <!-- FKs -->
            <column name="tenant_uid" type="text" remarks="type=fk;description=tenant UID"><constraints nullable="false"/></column>
            <column name="auth_identity_uid" type="text"><constraints nullable="false"/></column>
            <column name="auth_sso_uid" type="text" />
            <!-- attribute columns -->
            <column name="identity_parameters_json" type="text" remarks="type=secret;description=JSON with identity parameters - map of parameters string to object" defaultValue="{}"><constraints nullable="false"/></column>
            <column name="last_status_name" type="text" defaultValue="Unknown"><constraints nullable="false"/></column>
            <!-- metadata columns -->
            <column name="row_instance" type="text" remarks="FK to system instance" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="replace(concat('auid_v01_', substring(cast(now() as text), 1, 10), '_', substring(cast(uuid_generate_v4() as text), 1, 13)), '-', '_')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>
        <createIndex indexName="idx_auth_identity_tenant_tenant_uid" tableName="auth_identity_tenant" unique="false"><column name="tenant_uid" /></createIndex>

        <createTable tableName="auth_sso" remarks="type=full;cardinality=100;description=single sign on configuration" >
            <column name="auth_sso_uid" type="text"><constraints primaryKey="true" nullable="false"/></column>
            <column name="auth_sso_name" type="text" remarks="single sign on configuration"><constraints nullable="false"/></column>
            <!-- FKs -->
            <column name="tenant_uid" type="text" remarks="type=fk;description=tenant UID"><constraints nullable="false"/></column>
            <column name="owner_account_uid" type="text" />
            <column name="sso_name" type="text"><constraints nullable="false"/></column>
            <column name="sso_url" type="text"><constraints nullable="false"/></column>
            <column name="sso_key" type="text"><constraints nullable="false"/></column>
            <column name="sso_secret" type="text"><constraints nullable="false"/></column>
            <column name="sso_code" type="text" />
            <column name="clientid" type="text" />
            <column name="clientsecret" type="text" />
            <column name="callback_url" type="text" />
            <!-- metadata columns -->
            <column name="row_instance" type="text" remarks="FK to system instance" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="replace(concat('auid_v01_', substring(cast(now() as text), 1, 10), '_', substring(cast(uuid_generate_v4() as text), 1, 13)), '-', '_')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>
        <createIndex indexName="idx_auth_sso_tenant_uid" tableName="auth_sso" unique="false"><column name="tenant_uid" /></createIndex>

        <createTable tableName="auth_key_type" remarks="type=full;cardinality=1000;description=type of key: symmetric, asymmetric, signature, ..." >
            <column name="auth_key_type_uid" type="text"><constraints primaryKey="true" nullable="false"/></column>
            <column name="auth_key_type_name" type="text" remarks=""><constraints nullable="false"/></column>
            <!-- FKs -->
            <!-- attribute columns -->
            <column name="class_name" type="text"><constraints primaryKey="true" nullable="false"/></column>
            <!-- metadata columns -->
            <column name="row_instance" type="text" remarks="FK to system instance" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="replace(concat('auid_v01_', substring(cast(now() as text), 1, 10), '_', substring(cast(uuid_generate_v4() as text), 1, 13)), '-', '_')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>

        <createTable tableName="auth_key" remarks="type=full;cardinality=1000;description=key for encoding" >
            <column name="auth_key_uid" type="text" defaultValueComputed="generate_uid('aukey')"><constraints primaryKey="true" nullable="false"/></column>
            <column name="auth_key_name" type="text" remarks="name of identifying method, class to authenticate user or client"><constraints nullable="false"/></column>
            <!-- FKs -->
            <column name="tenant_uid" type="text" remarks="type=fk;description=tenant UID"><constraints nullable="false"/></column>
            <column name="owner_account_uid" type="text" />
            <column name="auth_key_type_uid" type="text" defaultValue="asymmetric"><constraints nullable="false"/></column>
            <column name="key_private" type="text"><constraints nullable="false"/></column>
            <column name="key_public" type="text" defaultValue=""><constraints nullable="false"/></column>
            <column name="key_length" type="bigint" defaultValueNumeric="1024"><constraints nullable="false"/></column>
            <column name="key_exponent" type="text" defaultValue=""><constraints nullable="false"/></column>
            <column name="key_modulus" type="text" defaultValue=""><constraints nullable="false"/></column>
            <column name="key_parameters_json" type="text"><constraints nullable="false"/></column>
            <!-- metadata columns -->
            <column name="row_instance" type="text" remarks="FK to system instance" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="replace(concat('aukey_v01_', substring(cast(now() as text), 1, 10), '_', substring(cast(uuid_generate_v4() as text), 1, 13)), '-', '_')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>
        <createIndex indexName="idx_auth_key_tenant_uid" tableName="auth_key" unique="false"><column name="tenant_uid" /></createIndex>

        <createTable tableName="auth_session" remarks="type=update;cardinality=1000000;description=UI sessions in browsers from UI application regarding connected accounts" >
            <column name="auth_session_uid" type="text" defaultValueComputed="generate_uid('auses')"><constraints primaryKey="true" nullable="false"/></column>
            <column name="auth_session_name" type="text" remarks="name of identifying method, class to authenticate user or client"><constraints nullable="false"/></column>
            <!-- FKs -->
            <column name="tenant_uid" type="text" remarks="type=fk;description=tenant UID" />
            <column name="account_uid" type="text" />
            <!-- attribute columns -->
            <column name="session_token" type="text"><constraints nullable="false"/></column>
            <column name="browser_name" type="text"><constraints nullable="false"/></column>
            <column name="browser_" type="text"><constraints nullable="false"/></column>
            <!-- metadata columns -->
            <column name="row_instance" type="text" remarks="FK to system instance" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="replace(concat('auses_v01_', substring(cast(now() as text), 1, 10), '_', substring(cast(uuid_generate_v4() as text), 1, 13)), '-', '_')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>
        <createIndex indexName="idx_auth_session_tenant_uid" tableName="auth_session" unique="false"><column name="tenant_uid" /></createIndex>
        <createIndex indexName="idx_auth_session_account_uid" tableName="auth_session" unique="false"><column name="account_uid" /></createIndex>

        <createTable tableName="auth_attempt" remarks="type=update;cardinality=1000000;possible identity types with configuration" >
            <column name="auth_attempt_uid" type="text" defaultValueComputed="generate_uid('auat')"><constraints primaryKey="true" nullable="false"/></column>
            <column name="auth_attempt_name" type="text" remarks="name of identifying method, class to authenticate user or client"><constraints nullable="false"/></column>
            <!-- FKs -->
            <column name="tenant_uid" type="text" remarks="type=fk;description=tenant UID" />
            <column name="account_uid" type="text" />
            <!-- attribute columns -->
            <column name="account_login" type="text"><constraints nullable="false"/></column>
            <column name="identity_type" type="text" remarks="type of identity to be translated into class name"><constraints nullable="false"/></column>
            <column name="identity_parameters" type="text" remarks="type=secret;description=JSON with identity parameters - map of parameters string to object" defaultValue="{}"><constraints nullable="false"/></column>
            <column name="last_status_name" type="text" defaultValue="Unknown"><constraints nullable="false"/></column>
            <!-- metadata columns -->
            <column name="row_instance" type="text" remarks="FK to system instance" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="replace(concat('auat_v01_', substring(cast(now() as text), 1, 10), '_', substring(cast(uuid_generate_v4() as text), 1, 13)), '-', '_')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>
        <createIndex indexName="idx_auth_identity_auth_identity_name" tableName="auth_identity" unique="true"><column name="auth_identity_name" /></createIndex>

        <createTable tableName="auth_token" remarks="type=update;cardinality=1000000;description=single instance of token created for account" >
            <column name="auth_token_uid" type="text" defaultValueComputed="cast(uuid_generate_v4() as text)"><constraints primaryKey="true" nullable="false"/></column>
            <column name="auth_token_name" type="text"><constraints nullable="false"/></column>
            <!-- FKs -->
            <column name="tenant_uid" type="text" remarks="type=fk;description=tenant UID"><constraints nullable="false"/></column>
            <column name="account_uid" type="text" remarks="parent account of this token"><constraints nullable="false"/></column>
            <!-- attribute columns -->
            <column name="token_seq" type="bigint" defaultValueNumeric="1"><constraints nullable="false"/></column>
            <column name="token_hash" type="text"><constraints nullable="false"/></column>
            <column name="token_salt" type="text"><constraints nullable="false"/></column>
            <column name="valid_till_date" type="timestamp" remarks="date and time of validation" />
            <column name="last_use_date" type="timestamp" remarks="date and time of insertion given row to database" />
            <column name="is_last" type="bigint" defaultValueNumeric="1"><constraints nullable="false"/></column>
            <!-- metadata columns -->
            <column name="row_instance" type="text" remarks="FK to system instance" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="replace(concat('auto_v01_', substring(cast(now() as text), 1, 10), '_', substring(cast(uuid_generate_v4() as text), 1, 13)), '-', '_')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>
        <createIndex indexName="idx_auth_token_account_uid" tableName="auth_token" unique="false"><column name="account_uid" /></createIndex>
        <createIndex indexName="idx_auth_token_token_hash" tableName="auth_token" unique="false"><column name="token_hash" /></createIndex>

        <createTable tableName="auth_role" remarks="type=update;cardinality=100;description=list of roles used in permissions" >
            <column name="auth_role_uid" type="text"><constraints primaryKey="true" nullable="false"/></column>
            <column name="auth_role_name" type="text"><constraints nullable="false"/></column>
            <!-- FKs -->
            <column name="parent_auth_role_uid" type="text" remarks="type=fk,parent;description=" />
            <column name="tenant_uid" type="text" remarks="type=fk;description=optional tenant UID" />
            <!-- attribute columns -->
            <column name="role_description" type="text" defaultValue=""><constraints nullable="false"/></column>
            <column name="access_uris" type="text" defaultValue=""><constraints nullable="false"/></column>
            <column name="is_project" type="bigint" defaultValueNumeric="0"><constraints nullable="false"/></column>
            <column name="is_tenant" type="bigint" defaultValueNumeric="0"><constraints nullable="false"/></column>
            <column name="is_client" type="bigint" defaultValueNumeric="0"><constraints nullable="false"/></column>
            <column name="is_custom" type="bigint" defaultValueNumeric="1"><constraints nullable="false"/></column>
            <!-- metadata columns -->
            <column name="row_instance" type="text" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="replace(concat('auro_v01_', substring(cast(now() as text), 1, 10), '_', substring(cast(uuid_generate_v4() as text), 1, 13)), '-', '_')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>
        <createIndex indexName="idx_auth_role_auth_role_name" tableName="auth_role" unique="true"><column name="auth_role_name" /></createIndex>

        <createTable tableName="auth_role_uri" remarks="type=dictionary,update;cardinality=10000;description=mapping between role and URIs" >
            <column name="auth_role_uri_uid" type="text" defaultValueComputed="cast(uuid_generate_v4() as text)"><constraints primaryKey="true" nullable="false"/></column>
            <column name="auth_role_uri_name" type="text" defaultValueComputed="cast(uuid_generate_v4() as text)"><constraints nullable="false"/></column>
            <!-- FKs -->
            <column name="auth_role_uid" type="text" remarks="type=fk,parent;description=" />
            <!-- attribute columns -->
            <column name="uri" type="text" defaultValue=""><constraints nullable="false"/></column>
            <!-- metadata columns -->
            <column name="row_instance" type="text" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="replace(concat('auro_v01_', substring(cast(now() as text), 1, 10), '_', substring(cast(uuid_generate_v4() as text), 1, 13)), '-', '_')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>

        <createTable tableName="auth_permission" remarks="type=update;cardinality=100000;permission assigned to account and role with optional project or client" >
            <column name="auth_permission_uid" type="text" defaultValueComputed="cast(uuid_generate_v4() as text)"><constraints primaryKey="true" nullable="false"/></column>
            <column name="auth_permission_name" type="text" defaultValueComputed="cast(uuid_generate_v4() as text)"><constraints nullable="false"/></column>
            <!-- FKs -->
            <column name="tenant_uid" type="text" remarks="UID of tenant"><constraints nullable="false"/></column>
            <column name="account_uid" type="text" remarks="parent account of this token"><constraints nullable="false"/></column>
            <column name="auth_role_uid" type="text"><constraints nullable="false"/></column>
            <column name="client_uid" type="text" />
            <column name="project_instance_uid" type="text" />
            <!-- attribute columns -->
            <column name="valid_from_date" type="timestamp" remarks="permission from date" defaultValueDate="${nowdate}"><constraints nullable="false"/></column>
            <column name="valid_till_date" type="timestamp" remarks="permission till date"><constraints nullable="false"/></column>
            <!-- FKs -->
            <!-- metadata columns -->
            <column name="row_instance" type="text" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="replace(concat('aupe_v01_', substring(cast(now() as text), 1, 10), '_', substring(cast(uuid_generate_v4() as text), 1, 13)), '-', '_')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>
        <createIndex indexName="idx_auth_permission_account_uid" tableName="auth_permission" unique="false"><column name="account_uid" /></createIndex>
        <createIndex indexName="idx_auth_permission_auth_role_uid" tableName="auth_permission" unique="false"><column name="auth_role_uid" /></createIndex>

        <createTable tableName="auth_password_rule" remarks="rule applied to new set passwords" >
            <column name="auth_password_uid" type="text" defaultValueComputed="generate_uid('aupr')"><constraints primaryKey="true" nullable="false"/></column>
            <column name="auth_password_name" type="text" defaultValueComputed="generate_uid('aupr')"><constraints nullable="false"/></column>
            <!-- FKs -->
            <column name="rule_type" type="bigint"><constraints nullable="false"/></column>
            <column name="rule_parameters" type="text" defaultValue=""><constraints nullable="false"/></column>
            <column name="user_scope" type="text" defaultValue=""><constraints nullable="false"/></column>
            <!-- metadata columns -->
            <column name="row_instance" type="text" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="replace(concat('aupr_v01_', substring(cast(now() as text), 1, 10), '_', substring(cast(uuid_generate_v4() as text), 1, 13)), '-', '_')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>

        <createTable tableName="auth_password" remarks="type=update;cardinality=100000;description=password set by user - this is full history of passwords" >
            <column name="auth_password_uid" type="text" defaultValueComputed="generate_uid('aupa')"><constraints primaryKey="true" nullable="false"/></column>
            <column name="auth_password_name" type="text" defaultValueComputed="generate_uid('aupa')"><constraints nullable="false"/></column>
            <!-- FKs -->
            <column name="tenant_uid" type="text" remarks="type=fk;description=tenant UID"><constraints nullable="false"/></column>
            <column name="account_uid" type="text" remarks="parent account of this password"><constraints nullable="false"/></column>
            <!-- attribute columns -->
            <column name="password_hash" type="text" remarks="type=secret;description=hash of password including salt"><constraints nullable="false"/></column>
            <column name="password_salt" type="text" remarks="type=secret;description=salt to add to password before hashing"><constraints nullable="false"/></column>
            <column name="date_from" type="timestamp" remarks="date and time od start password"><constraints nullable="false"/></column>
            <column name="date_to" type="timestamp" remarks="date and time of validation date of this password"><constraints nullable="false"/></column>
            <column name="usage_count" type="bigint" defaultValueNumeric="0" remarks="numer of password usages"><constraints nullable="false"/></column>
            <!-- metadata columns -->
            <column name="row_instance" type="text" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="replace(concat('aupa_v01_', substring(cast(now() as text), 1, 10), '_', substring(cast(uuid_generate_v4() as text), 1, 13)), '-', '_')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>
        <createIndex indexName="idx_auth_password_account_uid" tableName="auth_password" unique="false"><column name="account_uid" /></createIndex>

        <createTable tableName="auth_password_current" remarks="type=update;cardinality=10000;description=password set by user - only current valid password" >
            <column name="auth_password_current_uid" type="text" remarks="account UID" defaultValueComputed="generate_uid('aupc')"><constraints primaryKey="true" nullable="false"/></column>
            <column name="auth_password_current_name" type="text"><constraints nullable="false"/></column>
            <!-- FKs -->
            <column name="tenant_uid" type="text" remarks="type=fk;description=tenant UID"><constraints nullable="false"/></column>
            <column name="account_uid" type="text" remarks="parent account of this password"><constraints nullable="false"/></column>
            <!-- attribute columns -->
            <column name="password_hash" type="text" remarks="type=secret;description=hash of password including salt"><constraints nullable="false"/></column>
            <column name="password_salt" type="text" remarks="type=secret;description=salt to add to password before hashing"><constraints nullable="false"/></column>
            <column name="date_from" type="timestamp" remarks="date and time od start password"><constraints nullable="false"/></column>
            <column name="date_to" type="timestamp" remarks="date and time of validation date of this password"><constraints nullable="false"/></column>
            <column name="usage_count" type="bigint" defaultValueNumeric="0" remarks="numer of password usages"><constraints nullable="false"/></column>
            <!-- metadata columns -->
            <column name="row_instance" type="text" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="replace(concat('aupc_v01_', substring(cast(now() as text), 1, 10), '_', substring(cast(uuid_generate_v4() as text), 1, 13)), '-', '_')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>
        <createIndex indexName="idx_auth_password_current_account_uid" tableName="auth_password_current" unique="false"><column name="account_uid" /></createIndex>

        <createTable tableName="auth_request" remarks="type=append;cardinality=100000;description=Request of reset or set new password for user" >
            <column name="auth_request_uid" type="text" defaultValueComputed="generate_uid('aure')"><constraints primaryKey="true" nullable="false"/></column>
            <column name="auth_request_name" type="text" defaultValueComputed="generate_uid('aure')"><constraints nullable="false"/></column>
            <!-- FKs -->
            <column name="tenant_uid" type="text" remarks="type=fk;description=tenant UID"><constraints nullable="false"/></column>
            <column name="account_uid" type="text"><constraints nullable="false"/></column>
            <!-- attribute columns -->
            <column name="requestor_email" type="text"><constraints nullable="false"/></column>
            <column name="reset_guid" type="text" remarks="type=secret;description=global unique ID of this reset to be referred from the link"><constraints nullable="false"/></column>
            <column name="valid_till_date" type="timestamp" remarks="final date of validation of this request"><constraints nullable="false"/></column>
            <column name="lock_guid" type="text" remarks="type=secret;description=lock global unique ID" />
            <column name="lock_by" type="text" remarks="process that has been locked this request" />
            <column name="lock_date" type="timestamp" remarks="date and time of last lock" />
            <column name="is_checked" type="bigint" defaultValueNumeric="0"><constraints nullable="false"/></column>
            <column name="is_used" type="bigint" defaultValueNumeric="0"><constraints nullable="false"/></column>
            <column name="check_date" type="timestamp" remarks="date and time of check" />
            <column name="use_date" type="timestamp" remarks="date and time of use" />
            <column name="event_notification_uid" type="text" remarks="notification connected to this request" />
            <!-- metadata columns -->
            <column name="row_instance" type="text" defaultValue="1.0.0"><constraints nullable="false"/></column>
            <column name="row_lock" type="text" />
            <column name="row_owner" type="text" defaultValue="System" remarks="FK to account_group - owner of this row"><constraints nullable="false"/></column>
            <column name="row_seq" type="bigint" autoIncrement="true"><constraints nullable="false"/></column>
            <column name="row_guid" type="text" remarks="global generated unique ID" defaultValueComputed="replace(concat('aure_v01_', substring(cast(now() as text), 1, 10), '_', substring(cast(uuid_generate_v4() as text), 1, 13)), '-', '_')"><constraints nullable="false"/></column>
            <column name="row_version" type="bigint" defaultValueNumeric="0" remarks="version of the row"><constraints nullable="false"/></column>
            <column name="is_active" type="bigint" defaultValueNumeric="1" remarks="0 - row has been logically deleted, 1 - row is still active"><constraints nullable="false"/></column>
            <column name="created_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of insertion given row to database"><constraints nullable="false"/></column>
            <column name="created_by" type="text" defaultValue="system" remarks="account UID of person that created this row"><constraints nullable="false"/></column>
            <column name="last_updated_date" type="timestamp" defaultValueDate="${nowdate}" remarks="date and time of last change of this row"><constraints nullable="false"/></column>
            <column name="last_updated_by" type="text" defaultValue="system" remarks="account UID of person that updated this row"><constraints nullable="false"/></column>
            <column name="removed_date" type="timestamp" remarks="date and time of change this row" />
            <column name="removed_by" type="text" remarks="account UID of person that removed this row" />
            <column name="custom_attributes" type="text" defaultValue="{}"><constraints nullable="false"/></column>
        </createTable>
        <createIndex indexName="idx_auth_request_account_uid" tableName="auth_request" unique="false"><column name="account_uid" /></createIndex>

    </changeSet>

</databaseChangeLog>
